<!DOCTYPE html>
<html>
  <head>
    <title>Add Product</title>
    <style>
      /* style.css */

      /* Body styles */
      body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
      }

      /* Container styles */
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Form styles */
      .form {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .form label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .form input[type="text"],
      .form input[type="number"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
      }

      .form button {
        background-color: #4caf50;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .form button:hover {
        background-color: #45a049;
      }

      /* Table styles */
      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th,
      .table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }

      .table th {
        background-color: #f2f2f2;
        font-weight: bold;
      }

      /* Image styles */
      .product-image {
        max-width: 100%;
        height: auto;
        margin-bottom: 10px;
      }

      /* Success message styles */
      .success-message {
        background-color: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
      }

      /* Error message styles */
      .error-message {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Add Product</h1>
    <form id="productForm">
      <div>
        <label for="productImage">Product Image:</label>
        <input type="file" id="productImage" name="productImage" />
      </div>
      <div>
        <label for="productName">Product Name:</label>
        <input type="text" id="productName" name="productName" />
      </div>
      <div>
        <label for="productdiscription">Product Discription :</label>
        <input type="text" id="productdiscription" name="productdiscription" />
      </div>
      <div>
        <label for="productCost">Product Cost:</label>
        <input type="number" id="productCost" name="productCost" />
      </div>
      <div>
        <label for="carbonFootprint">Carbon Footprint:</label>
        <input type="number" id="carbonFootprint" name="carbonFootprint" />
      </div>
      <div>
        <label for="sustainabilityScore">Sustainability Score:</label>
        <input
          type="number"
          id="sustainabilityScore"
          name="sustainabilityScore"
        />
      </div>
      <div>
        <input type="submit" value="Add Product" />
      </div>
    </form>

    <script>
      const productForm = document.getElementById("productForm");
      productForm.addEventListener("submit", (e) => {
        e.preventDefault();

        if (sessionStorage.getItem("userloggedin") != "true") {
          alert("Please login first");
          return;
        }

        var productImage = document.getElementById("productImage").value;
        var productName = document.getElementById("productName").value;
        var productdiscription =
          document.getElementById("productdiscription").value;
        var productCost = document.getElementById("productCost").value;
        var carbonFootprint = document.getElementById("carbonFootprint").value;
        var sustainabilityScore = document.getElementById(
          "sustainabilityScore"
        ).value;

        // Validate form values
        if (
          productImage === "" ||
          productName === "" ||
          productCost === "" ||
          carbonFootprint === "" ||
          sustainabilityScore === "" ||
          productdiscription === ""
        ) {
          alert("Please fill in all fields");
          return;
        }

        var finalurl;
        const fileInput = document.getElementById("productImage");

        const formData = new FormData();
        formData.append("file", fileInput.files[0]);
        fetch("/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            finalurl = data.url;
            var kk = sessionStorage.getItem("userdetails");
            const userDetails = JSON.parse(kk);

            const Product = {
              product_image_url: finalurl,
              product_name: productName,
              product_cost: productCost,
              carbon_footprint: carbonFootprint,
              sustainability_score: sustainabilityScore,
              product_discription : productdiscription,
              seller_id: userDetails.profile_id,
            };
            console.log(finalurl);
            console.log(Product);
            fetch("/products", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(Product),
            }).then((response) => {
              if (response.status === 201) {
                alert("Product added successfully");
              } else if (response.status === 409) {
                alert("filed adding product");
              }
            });
          });
      });
    </script>
  </body>
</html>
